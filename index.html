<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8">
<title>Secure Payment</title>

<style>
body{
    margin:0;
    background:#edf1f7;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
}

.container{
    max-width:430px;
    margin:25px auto;
    background:white;
    border-radius:16px;
    box-shadow:0 15px 40px rgba(0,0,0,0.08);
    overflow:hidden;
}

.header{
    background:#1f6feb;
    color:white;
    padding:18px;
    font-size:20px;
    font-weight:600;
    text-align:center;
}

.timer{
    text-align:center;
    padding:10px;
    font-weight:600;
    color:#d35400;
}

.step{
    background:#e8f1ff;
    color:#1f6feb;
    padding:12px;
    font-weight:600;
}

.box{
    padding:15px;
}

.row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin:14px 0;
}

.label{
    color:#6b7280;
    font-size:14px;
}

.value{
    font-size:18px;
    font-weight:600;
}

.copy{
    background:#1f6feb;
    border:none;
    color:white;
    padding:7px 12px;
    border-radius:7px;
    cursor:pointer;
}

.qr{
    display:block;
    margin:18px auto;
}

.note{
    background:#fff4e5;
    padding:12px;
    border-radius:8px;
    color:#b45309;
    font-size:14px;
}

input{
    width:100%;
    padding:14px;
    border-radius:8px;
    border:1px solid #d1d5db;
    margin-top:12px;
    font-size:16px;
}

.submit{
    width:100%;
    padding:15px;
    margin-top:10px;
    background:#16a34a;
    color:white;
    border:none;
    border-radius:8px;
    font-size:17px;
}

.success,.expired{
    display:none;
    text-align:center;
    padding:40px;
}

.copyMsg{
    text-align:center;
    color:green;
    display:none;
}

/* Quick Pay buttons styling */
.quick-pay-container {
    text-align:center;
    margin:20px 0;
}

.quick-pay-label {
    font-weight:600;
    margin-bottom:12px;
    display:block;
}

.quick-pay-buttons {
    display:flex;
    justify-content:center;
    gap:15px;
    flex-wrap:wrap;
}

.quick-pay-btn {
    border:none;
    color:white;
    padding:12px 24px;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
    min-width:140px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
}

.gpay { background:#1a73e8; }
.phonepe { background:#5f2ee5; }
.paytm { background:#00baf2; }
</style>
</head>

<body>

<div class="container" id="paymentCard">

<div class="header" id="appName">
Secure Payment
</div>

<div class="timer">
Link expires in <span id="countdown">05:00</span>
</div>

<div class="step">Step 1 : Copy Payment Details or Quick Pay</div>

<div class="box">

<!-- AMOUNT -->
<div class="row">
<div>
<div class="label">Amount</div>
<div class="value" id="amount"></div>
</div>
<button class="copy" onclick="copyText('amountRaw')">Copy</button>
</div>

<!-- UPI -->
<div class="row">
<div>
<div class="label">UPI ID</div>
<div class="value" id="upi"></div>
</div>
<button class="copy" onclick="copyText('upi')">Copy</button>
</div>

<div class="copyMsg" id="copyMsg">Copied ✓</div>

<img id="qr" class="qr" width="210"/>

<div class="quick-pay-container">
    <div class="quick-pay-label">Quick Pay with</div>
    <div class="quick-pay-buttons">
        <button class="quick-pay-btn gpay" onclick="openUPIApp('gpay')">Google Pay</button>
        <button class="quick-pay-btn phonepe" onclick="openUPIApp('phonepe')">PhonePe</button>
        <button class="quick-pay-btn paytm" onclick="openUPIApp('paytm')">Paytm</button>
    </div>
</div>

</div>

<div class="step">Step 2 : Complete Payment</div>

<div class="box">
<div class="note">
Do not use old payment details. Complete the transfer immediately.
</div>
</div>

<div class="step">Step 3 : Enter UTR / Reference Number</div>

<div class="box">

<input maxlength="12" id="utr" placeholder="Enter 12-digit UTR"/>

<button class="submit" onclick="submitUTR()">
Submit Payment
</button>

</div>

</div>



<!-- SUCCESS -->

<div class="container success" id="successCard">

<h2 style="color:#16a34a;">✔ Payment Submitted</h2>

<p>
Your payment is being verified.<br>
Please allow a few minutes for confirmation.
</p>

</div>



<!-- EXPIRED -->

<div class="container expired" id="expiredCard">

<h2>Link Expired</h2>
<p>Please request a new payment link.</p>

</div>



<script>

/* PARAMETERS */

const params = new URLSearchParams(window.location.search);

const app = params.get("app");
const customer = params.get("customer");
const amount = params.get("amount") || "1";
const upi = params.get("upi") || "upi@bank";


/* AUTO HIDE / POPULATE */

if(app){
    document.getElementById("app").innerText = app;
    document.getElementById("appName").innerText = app;
} else {
    // If no app, we can keep merchant row hidden or adjust
    // For now, assuming amount & upi are main
}

document.getElementById("amount").innerText = "₹" + amount;
document.getElementById("upi").innerText = upi;


/* RAW AMOUNT for copy & deep links */

const raw = document.createElement("span");
raw.id = "amountRaw";
raw.style.display = "none";
raw.innerText = amount;
document.body.appendChild(raw);


/* QR */

const pay = `upi://pay?pa=\( {upi}&pn= \){app || "Payment"}&am=${amount}&cu=INR`;

document.getElementById("qr").src =
`https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(pay)}`;


/* COPY */

function copyText(id){
    navigator.clipboard.writeText(document.getElementById(id).innerText);
    const msg = document.getElementById("copyMsg");
    msg.style.display = "block";
    setTimeout(()=>msg.style.display="none",1000);
}


/* QUICK PAY BUTTONS - Direct deep links */

function openUPIApp(appType) {
    const upiId = document.getElementById("upi").innerText;
    const amt = document.getElementById("amountRaw").innerText;
    const pn = document.getElementById("appName").innerText || "Payment";
    const tn = "Secure Payment via Merchant"; // optional note

    let baseParams = `pa=\( {encodeURIComponent(upiId)}&pn= \){encodeURIComponent(pn)}&am=\( {amt}&cu=INR&tn= \){encodeURIComponent(tn)}`;

    let uri = "";

    if (appType === 'gpay') {
        uri = `tez://upi/pay?${baseParams}`;  // tez:// works reliably for Google Pay
        // Alternative: gpay://upi/pay?${baseParams}  -- try if tez fails
    } else if (appType === 'phonepe') {
        uri = `phonepe://pay?${baseParams}`;
    } else if (appType === 'paytm') {
        uri = `paytmmp://pay?${baseParams}`;
    }

    if (uri) {
        window.location.href = uri;
    }

    // Optional: silent fallback after \~1.5s if app doesn't launch
    setTimeout(() => {
        // Could add alert("App not opening? Try QR code or copy UPI.") but keeping clean
    }, 1500);
}


/* TIMER */

let time = 300;

const countdown = setInterval(() => {
    let m = Math.floor(time / 60);
    let s = time % 60;
    if (s < 10) s = "0" + s;
    document.getElementById("countdown").innerText = `\( {m}: \){s}`;
    time--;
    if (time < 0) {
        clearInterval(countdown);
        document.getElementById("paymentCard").style.display = "none";
        document.getElementById("expiredCard").style.display = "block";
    }
}, 1000);


/* SUBMIT UTR */

function submitUTR(){
    if (time < 0) return;
    const utr = document.getElementById("utr").value;
    if (!/^[0-9]{12}$/.test(utr)) return;
    document.getElementById("paymentCard").style.display = "none";
    document.getElementById("successCard").style.display = "block";
}

</script>

</body>
</html>
